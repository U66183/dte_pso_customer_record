sap.ui.define(["sap/ui/core/mvc/Controller","com/pso/customerattribute/utils/Formatter","sap/ui/model/odata/ODataModel","sap/ui/model/json/JSONModel","sap/ui/model/type/String","sap/m/ColumnListItem","sap/m/Label","sap/m/SearchField","sap/m/Token","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ushell/ui5service/ShellUIService","sap/ui/comp/smartvariants/PersonalizableInfo","sap/ui/export/Spreadsheet"],function(e,t,i,r,a,o,s,n,l,u,d,p,g,c){"use strict";return e.extend("com.pso.customerattribute.controller.SearchCustomer",{onInit:function(){this.oDataModel=this.getOwnerComponent().getModel();this.oView=this.getView();this.onActivatingStandardFilter();this.onLetsDoBusy();this.fetchDropdownData()},getUserDetails:async function(){var e=this.getOwnerComponent().getModel();let t=null;var i=e.bindContext("/userDetails(...)");await i.execute().then(function(e){var r=i.getBoundContext().getObject();console.log(r);t=r.value}.bind(this),function(e){console.log(e.message)}.bind(this));this.userScope=t;console.log(this.userScope)},onActivatingStandardFilter:function(){this.applyData=this.applyData.bind(this);this.fetchData=this.fetchData.bind(this);this.oSmartVariantManagement=this.getView().byId("svm");this.oFilterBar=this.getView().byId("_IDGenFilterBar1");this.getFiltersWithValues=this.getFiltersWithValues.bind(this);this.oFilterBar.registerFetchData(this.fetchData);this.oFilterBar.registerApplyData(this.applyData);this.oFilterBar.registerGetFiltersWithValues(this.getFiltersWithValues);var e=new g({type:"filterBar",keyName:"persistencyKey",dataSource:"",control:this.oFilterBar});this.oSmartVariantManagement.addPersonalizableControl(e);this.oSmartVariantManagement.initialise(function(){},this.oFilterBar)},applyData:function(e){e.forEach(function(e){var t=this.oFilterBar.determineControlByName(e.fieldName,e.groupName);t.setValue(e.fieldData)},this)},fetchData:function(){var e=this.oFilterBar.getAllFilterItems().reduce(function(e,t){e.push({groupName:t.getGroupName(),fieldName:t.getName(),fieldData:t.getControl().getValue()});return e},[]);return e},getFiltersWithValues:function(){var e=this.oFilterBar.getFilterGroupItems().reduce(function(e,t){var i=t.getControl();if(i&&i.getValue&&i.getValue().length>0){e.push(t)}return e},[]);return e},onLetsDoBusy:function(){this.oBusyIndicator=0;this.oBusyIndicator=this.oBusyIndicator?this.oBusyIndicator:new sap.m.BusyDialog({text:"",title:"Fetching data..."});return this.oBusyIndicator},fetchDropdownData:function(){var e=this;var t=this.getOwnerComponent().getModel("dropDownJsonModel");this.oBusyIndicator.open();this.getOwnerComponent().getModel("ISUService").read("/DropdownSet",{success:function(i){e.oBusyIndicator.close();if(i.results.length>0){t.setProperty("/DropdownData",i.results)}},error:function(i){e.oBusyIndicator.close();sap.m.MessageBox.show(i.message,{icon:sap.m.MessageBox.Icon.ERROR,title:"Error",actions:[sap.m.MessageBox.Action.OK]});t.setData(oData.results)}})},fetchItems:function(){var e=this;var t=this.oView.getModel("oSearchCustomerJModel");var i=this.oView.byId("idcustomer").getValue();var r=this.oView.byId("idMailingname").getValue();var a=this.oView.byId("idStreetAdd").getValue();var o=this.oView.byId("idStreetNo").getValue();var s=this.oView.byId("idCity").getValue();var n=this.oView.byId("idzipcode").getValue();var l=this.oView.byId("idNoofline").getValue();var p=this.oView.byId("idsrvcenter").getValue();var g=this.oView.byId("idcableno").getValue();var c=this.oView.byId("idPswdigram").getValue();var h=this.oView.byId("idPrimarySRep").getSelectedKey();var m=this.oView.byId("idAcRep").getValue();var y=this.oView.byId("idSubstation").getValue();var w=this.oView.byId("idSrvSketchno").getValue();var F=this.oView.byId("idCircuit").getValue();var b=[];b.push(new u("cust_name",d.EQ,i));b.push(new u("mail_name",d.EQ,r));b.push(new u("street_name",d.EQ,a));b.push(new u("street_no",d.EQ,o));b.push(new u("city",d.EQ,s));b.push(new u("zip_code",d.EQ,n));b.push(new u("no_of_lines",d.EQ,l));b.push(new u("srv_centre",d.EQ,p));b.push(new u("cable_no",d.EQ,g));b.push(new u("doc_id",d.EQ,c));b.push(new u("psr",d.EQ,h));b.push(new u("acc_rep",d.EQ,m));b.push(new u("sub_station",d.EQ,y));b.push(new u("sketch_no",d.EQ,w));b.push(new u("circuit",d.EQ,F));this.oBusyIndicator.open();this.getOwnerComponent().getModel("ISUService").read("/Customer_searchSet",{filters:[b],success:function(i){e.oBusyIndicator.close();if(i.results.length>0){e.oView.byId("idNoofRec").setText(i.results.length);t.setProperty("/CustomersData",i.results)}else{t.setData([]);e.oView.byId("idNoofRec").setText(i.results.length)}},error:function(i){e.oBusyIndicator.close();sap.m.MessageBox.show(i.statusText,{icon:sap.m.MessageBox.Icon.ERROR,title:"Error",actions:[sap.m.MessageBox.Action.OK]});t.setData([]);e.oView.byId("idNoofRec").setText("")}})},handleSelectionChange:function(e){var t=e.getSource().getBindingContext("oSearchCustomerJModel").getProperty();var i=this.getOwnerComponent().getModel("oCustomerAttributesJModel");i.setData(t);var r=sap.ui.core.UIComponent.getRouterFor(this);r.navTo("CustomerDetails",{scope:"cd_create"})},handleTableSearch:function(e){var t=e.getSource().getValue();var i=new u("cust_name",d.Contains,t);var r=new u("mail_name",d.Contains,t);var a=new u("street_name",d.Contains,t);var o=new u("street_no",d.Contains,t);var s=new u("city",d.Contains,t);var n=new u("zip_code",d.Contains,t);var l=new u("no_of_lines",d.Contains,t);var p=new u("srv_centre",d.Contains,t);var g=new u("cable_no",d.Contains,t);var c=new u("sketch_no",d.Contains,t);var h=new u("doc_id",d.Contains,t);var m=new u("psr",d.Contains,t);var y=new u("acc_rep",d.Contains,t);var w=new u("sub_station",d.Contains,t);var F=new u("circuit",d.Contains,t);var b=new u("conn_obj",d.Contains,t);var V=new u([i,r,a,o,s,n,l,p,g,c,h,m,y,w,F,b],false);this.oView.byId("idCustomerListTable").getBinding("items").filter([V])},onTableColumnFilterButtonPress:function(){var e=this.oView.getModel("oSearchCustomerJModel");var t=e.getProperty("/CustomersData");if(t.length>0){if(!this._oColumnFilterDialog){this._oColumnFilterDialog=sap.ui.xmlfragment("idColumnFiltersFrag","com.pso.customerattribute.fragment.ColumnFilters",this);this.getView().addDependent(this._oColumnFilterDialog)}sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragCustName").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragMailingName").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragBillingentity").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragStreetAdd").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragStreetNo").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idFragCity").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragZipcode").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragNoofLines").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragSrvCenter").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragCableNo").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragpswdigram").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragPrimerySrvRep").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragAccRep").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragSubstation").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragSketchNo").setValue("");sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragCircuit").setValue("");this._oColumnFilterDialog.open()}},onValidReportsColumnFilterConfirm:function(){var e=this.getView().byId("idCustomerListTable");var t=e.getBinding("items");var i=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragCustName").getValue(),r=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragMailingName").getValue(),a=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragBillingentity").getValue(),o=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragStreetAdd").getValue(),s=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragStreetNo").getValue(),n=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idFragCity").getValue(),l=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragZipcode").getValue(),p=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragNoofLines").getValue(),g=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragSrvCenter").getValue(),c=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragCableNo").getValue(),h=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragpswdigram").getValue(),m=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragPrimerySrvRep").getValue(),y=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragAccRep").getValue(),w=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragSubstation").getValue(),F=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragSketchNo").getValue(),b=sap.ui.core.Fragment.byId("idColumnFiltersFrag","idfragCircuit").getValue();if(i===""&&r===""&&a===""&&o===""&&s===""&&n===""&&l===""&&p===""&&g===""&&c===""&&h===""&&m===""&&y===""&&w===""&&F===""&&b===""){t.filter([])}else{var V=[];if(i!==""){V.push(new u("cust_name",d.EQ,i))}if(r!==""){V.push(new u("mail_name",d.EQ,r))}if(a!==""){V.push(new u("conn_obj",d.EQ,a))}if(o!==""){V.push(new u("street_name",d.EQ,o))}if(s!==""){V.push(new u("street_no",d.EQ,s))}if(n!==""){V.push(new u("city",d.EQ,n))}if(l!==""){V.push(new u("zip_code",d.EQ,l))}if(p!==""){V.push(new u("no_of_lines",d.EQ,p))}if(g!==""){V.push(new u("srv_centre",d.EQ,g))}if(c!==""){V.push(new u("cable_no",d.EQ,c))}if(h!==""){V.push(new u("doc_id",d.EQ,h))}if(m!==""){V.push(new u("psr",d.EQ,m))}if(y!==""){V.push(new u("acc_rep",d.EQ,y))}if(w!==""){V.push(new u("sub_station",d.EQ,w))}if(F!==""){V.push(new u("sketch_no",d.EQ,F))}if(b!==""){V.push(new u("circuit",d.EQ,b))}var f=new u(V,true);t.filter(f)}},onValidReportsColumnFilterCancel:function(){var e=this.getView().byId("idCustomerListTable");var t=e.getBinding("items");t.filter([])},onValidReportsColumnFilterRemove:function(){var e=this.getView().byId("idCustomerListTable");var t=e.getBinding("items");t.filter([])},onValidReportsTableSorting:function(e){this._getValidReportsTableSortDialog().open()},_getValidReportsTableSortDialog:function(){var e=this.oView.getModel("oSearchCustomerJModel");if(!this._oValidReportsTableSortDialog){this._oValidReportsTableSortDialog=sap.ui.xmlfragment(this.createId("idValidReportsTableSortFrag"),"com.pso.customerattribute.fragment.TableSort",this);this.getView().addDependent(this._oValidReportsTableSortDialog)}return this._oValidReportsTableSortDialog},onTableSortConfirm:function(e){var t=e.getParameter("sortItem").getKey(),i=e.getParameter("sortDescending");var r=this.getView().byId("idCustomerListTable"),a=this.getView().byId("idTableSort");this._oValidReportsTableSortSelection={path:t,desc:i};a.setType("Emphasized");var o=new sap.ui.model.Sorter(this._oValidReportsTableSortSelection.path,this._oValidReportsTableSortSelection.desc);r.getBinding("items").sort(o)},onValidReportsTableExport:function(){var e,t,i,r,a;var o=this.oView.getModel("oSearchCustomerJModel");var t=o.getProperty("/CustomersData");var s=this.getResourceBundle();a=s.getText("customerReport");if(t.length>0){e=this.getColumnConfig(s);i={workbook:{columns:e},dataSource:t,fileName:a+".xlsx",worker:true,sheetName:"Customer Records",metaSheetName:"Customer Records",title:"Customer Records",application:"Records"};r=new c(i);r.build().finally(function(){r.destroy()})}},getColumnConfig:function(e){var t=[];t.push({label:e.getText("Fcutname"),type:sap.ui.export.EdmType.String,property:"cust_name",width:20,wrap:true});t.push({label:e.getText("FMailingname"),type:sap.ui.export.EdmType.String,property:"mail_name",width:20,wrap:true});t.push({label:e.getText("FBillingEntity"),type:sap.ui.export.EdmType.String,property:"conn_obj",width:20,wrap:true});t.push({label:e.getText("FStreetAdd"),type:sap.ui.export.EdmType.String,property:"street_name",width:20,wrap:true});t.push({label:e.getText("FStreetNo"),type:sap.ui.export.EdmType.String,property:"street_no",width:20,wrap:true});t.push({label:e.getText("Fcity"),type:sap.ui.export.EdmType.String,property:"city",width:20,wrap:true});t.push({label:e.getText("FZipcod"),type:sap.ui.export.EdmType.String,property:"zip_code",width:20,wrap:true});t.push({label:e.getText("FNumberoflines"),type:sap.ui.export.EdmType.String,property:"no_of_lines",width:20,wrap:true});t.push({label:e.getText("Fsrvcenter"),type:sap.ui.export.EdmType.String,property:"srv_centre",width:20,wrap:true});t.push({label:e.getText("Fcableno"),type:sap.ui.export.EdmType.String,property:"cable_no",width:20,wrap:true});t.push({label:e.getText("Fsrvsktchno"),type:sap.ui.export.EdmType.String,property:"sketch_no",width:20,wrap:true});t.push({label:e.getText("Fpswidigram"),type:sap.ui.export.EdmType.String,property:"doc_id",width:20,wrap:true});t.push({label:e.getText("Fprimeryrvrep"),type:sap.ui.export.EdmType.String,property:"psr",width:20,wrap:true});t.push({label:e.getText("Faccountrp"),type:sap.ui.export.EdmType.String,property:"acc_rep",width:20,wrap:true});t.push({label:e.getText("Fsustatoin"),type:sap.ui.export.EdmType.String,property:"sub_station",width:20,wrap:true});t.push({label:e.getText("Fcircuit"),type:sap.ui.export.EdmType.String,property:"circuit",width:20,wrap:true});return t},getResourceBundle:function(){return this.getOwnerComponent().getModel("i18n").getResourceBundle()},onClear:function(){var e=this.getOwnerComponent().getModel("oSearchCustomerJModel");e.setProperty("/CustomersData",[]);this.oView.byId("idcustomer").setValue();this.oView.byId("idMailingname").setValue();this.oView.byId("idStreetAdd").setValue();this.oView.byId("idStreetNo").setValue();this.oView.byId("idCity").setValue();this.oView.byId("idzipcode").setValue();this.oView.byId("idNoofline").setValue();this.oView.byId("idsrvcenter").setValue();this.oView.byId("idcableno").setValue();this.oView.byId("idPswdigram").setValue();this.oView.byId("idPrimarySRep").setSelectedKey();this.oView.byId("idAcRep").setValue();this.oView.byId("idSubstation").setValue();this.oView.byId("idSrvSketchno").setValue();this.oView.byId("idCircuit").setValue();this.oView.byId("idNoofRec").setText("0")},onCapitalizeFirtsLater:function(e){var t=e.getSource();var i=t.getValue();var r=this.capitalizeFirstLetterOfEachWord(i);t.setValue(r)},capitalizeFirstLetterOfEachWord:function(e){return e.replace(/\b\w/g,function(e){return e.toUpperCase()})}})});
//# sourceMappingURL=SearchCustomer.controller.js.map