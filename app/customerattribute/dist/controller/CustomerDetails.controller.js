sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/Fragment"],function(e,t){"use strict";return e.extend("com.pso.customerattribute.controller.CustomerDetails",{onInit:function(){var e=this.getOwnerComponent().getRouter();e.getRoute("CustomerDetails").attachMatched(function(e){this._loadFragmentPerScope(e.getParameter("arguments").scope)},this);this.oEditFlag=""},_loadFragmentPerScope:function(e){var t=this.getOwnerComponent().getModel("oCustomerAttributesJModel").oData.superior_flag;if(t=="X"){this.getView().byId("_IDButtonCreateRecord").setText("Create Record");this.getView().byId("idpanel").setVisible(true);this.getView().byId("idpanel2").setVisible(false);this.getView().byId("_IDButtonCreateRecord").setVisible(true);this.getView().byId("_IDButtonEditRecord").setVisible(false);this.getView().byId("_IDGenButtonCreateSp").setVisible(false);this.getView().byId("idButtonOpentext").setVisible(false);this.getView().byId("idButtonCreateServiceTicket").setVisible(false);this.getView().byId("_IDGenButtonDisplaySp").setVisible(false)}else if(t==""){this.getView().byId("idpanel").setVisible(false);this.getView().byId("idpanel2").setVisible(true);this.getView().byId("_IDButtonEditRecord").setVisible(true);this.getView().byId("_IDButtonCreateRecord").setVisible(false);this.getView().byId("idPageSecEmerContact_DC").setVisible(true);this.getView().byId("idButtonCreateServiceTicket").setVisible(true);this.getView().byId("idButtonOpentext").setVisible(true);this.getCustomerAttribute()}else if(e=="cd_display_limited"&&t==""){this.getView().byId("idpanel").setVisible(false);this.getView().byId("idpanel2").setVisible(true);this.getView().byId("idPageSecEmerContact_DC").setVisible(false)}},onEditCustomerAttribute:function(){this.oEditFlag="X";this.getView().byId("_IDButtonCreateRecord").setText("Update Record");this.getView().byId("idpanel").setVisible(true);this.getView().byId("idpanel2").setVisible(false);this.getView().byId("_IDButtonCreateRecord").setVisible(true);this.getView().byId("_IDButtonEditRecord").setVisible(false);this.getView().byId("idButtonCreateServiceTicket").setVisible(false);this.getView().byId("idButtonOpentext").setVisible(false)},onSpecialsExist:function(e){if(e){this.getView().byId("_IDGenButtonCreateSp").setVisible(false);this.getView().byId("_IDGenButtonDisplaySp").setVisible(true)}else{this.getView().byId("_IDGenButtonCreateSp").setVisible(true);this.getView().byId("_IDGenButtonDisplaySp").setVisible(false)}},onHelpSubstation:function(e){var t=this.getOwnerComponent().getModel("ISUService").sServiceUrl+"/substation_dropdownSet";var i=this.getView().getModel("oSubstationJModel");i.loadData(t,null,false,"GET",false,false,null);var s=new sap.m.SelectDialog({title:"Substation",contentHeight:"50%",titleAlignment:"Center",items:{path:"/d/results",template:new sap.m.StandardListItem({title:"{substation}",description:"",customData:[new sap.ui.core.CustomData({key:"Key",value:"{substation}"})]})},liveChange:function(e){var t=e.getParameter("value");var i=new sap.ui.model.Filter("substation",sap.ui.model.FilterOperator.Contains,t);e.getSource().getBinding("items").filter([i])},confirm:[this._handleSubstationClose,this],cancel:[this._handleSubstationClose,this]});s.setModel(i);s.open()},_handleSubstationClose:function(e){var t=e.getParameter("selectedItem");if(t){this.objSubstation=t.getBindingContext().getObject();this.getView().byId("idSubstation_CC").setValue(t.getTitle());this.getView().byId("idCircuit_CC").setValue()}},onHelpCircuit:function(e){var t=this.getView().byId("idSubstation_CC").getValue();if(t===""){sap.m.MessageBox.show(this.getView().getModel("i18n").getProperty("text_note_mandatory"),{icon:sap.m.MessageBox.Icon.WARNING,title:this.getView().getModel("i18n").getProperty("error"),actions:[sap.m.MessageBox.Action.OK]});this.getView().byId("idCircuit_CC").setValue();return}this.oDCPLIND=this.getView().byId("idDCPLIND_CC").getSelectedButton().getText();var i=this.getOwnerComponent().getModel("ISUService").sServiceUrl+"/circuit_dropdownSet";var s=this.getView().getModel("oCircuitJModel");s.loadData(i,null,false,"GET",false,false,null);var o=new sap.ui.model.Filter("substation",sap.ui.model.FilterOperator.EQ,this.objSubstation.substation);var n=new sap.ui.model.Filter("dc_pl",sap.ui.model.FilterOperator.EQ,this.oDCPLIND);var a=[o,n];var r=new sap.m.SelectDialog({title:"Circuit",contentHeight:"50%",titleAlignment:"Center",items:{path:"/d/results",template:new sap.m.StandardListItem({title:"{circuit}",description:"",customData:[new sap.ui.core.CustomData({key:"Key",value:"{circuit}"})]})},liveChange:function(e){var t=e.getParameter("value");var i=new sap.ui.model.Filter("circuit",sap.ui.model.FilterOperator.Contains,t);e.getSource().getBinding("items").filter([i])},confirm:[this._handleCircuitClose,this],cancel:[this._handleCircuitClose,this]});r.setModel(s);var l=r.getBinding("items");l.filter([a]);r.open()},_handleCircuitClose:function(e){var t=e.getParameter("selectedItem");if(t){this.obj=t.getBindingContext().getObject();this.getView().byId("idCircuit_CC").setValue(t.getTitle())}},getCustomerAttribute:function(){var e=this.getOwnerComponent().getModel("oCustomerAttributesJModel").oData.conn_obj;this.fetchSpecialsRecord(e);var t=this.getOwnerComponent().getModel("oCustomerAttributesJModel");this.getOwnerComponent().getModel("ISUService").read("/Customer_attributeSet(conn_obj='"+e+"')",{success:function(e){t.setData(e)},error:function(e){sap.m.MessageBox.show(e.message,{icon:sap.m.MessageBox.Icon.ERROR,title:"Error",actions:[sap.m.MessageBox.Action.OK]});t.setData([])}})},onDCPLINDSelect:function(){var e=this.getView().byId("idCircuit_CC");e.setValue();var t=this.oView.byId("idDCPLIND_CC").getSelectedButton();this.oDCPLIND=t.getText();if(this.oDCPLIND==="IND"){this.oView.byId("idTrans_CC").setVisible(true);e.setValue();e.setEnabled(false)}else{this.oView.byId("idTrans_CC").setVisible(false);e.setEnabled(true)}},launchOpentextURL:async function(e){const t=this.getView().getModel("oCustomerAttributesJModel").getData().conn_obj;console.log(t);const i="&bokey="+t+"&language=EN";var s=this.getOwnerComponent().getModel();var o=s.bindContext("/launchOpenTextURL(...)");await o.execute().then(function(e){var t=o.getBoundContext().getObject();console.log(t.value);let s=t.value+i;console.log(s);window.open(s,"_blank")}.bind(this),function(e){MessageBox.error(e.message)}.bind(this))},createCustomerDetails:function(){var e=this.getView().byId("idStreetno_CC").getValue();var t=this.getView().byId("idStreetAdd_CC").getValue();if(e===""||t===""){sap.m.MessageBox.show(this.getView().getModel("i18n").getProperty("document_note_mandatory"),{icon:sap.m.MessageBox.Icon.WARNING,title:this.getView().getModel("i18n").getProperty("error"),actions:[sap.m.MessageBox.Action.OK]});return}var i=[];var s=this.getView().getModel("oCustomerAttributesJModel").getData();var o=this.getView().byId("idDCPLIND_CC").getSelectedIndex();var n="",a="",r="";if(o===0){n="X"}else if(o===1){a="X"}else{r="X"}var l=this.getView().byId("idGeneration_CC").getSelectedIndex();var c="",d="",g="",u="";if(l===0){c="X"}else if(l===1){d="X"}else if(l===2){g="X"}else{u="X"}var p=this.getView().byId("idNoOfline_CC").getSelectedKey();var b=this.getView().byId("idSrvCenter_CC").getSelectedKey();var h=this.getView().byId("idPSR_CC").getSelectedKey();var C=this.getView().byId("idProEqp1_CC").getSelectedKey();var m=this.getView().byId("idProEqp2_CC").getSelectedKey();var _=this.getView().byId("idThrowoverTyp_CC").getSelectedKey();var w=this.getView().byId("idServiceType_CC").getSelectedKey();var V=this.getView().byId("idComents_CC").getValue();var y={};y.conn_obj=s.conn_obj,y.cust_name=s.cust_name,y.street_no=s.street_no,y.street_name=s.street_name,y.city=s.city,y.zip_code=s.zip_code,y.no_of_lines=p,y.srv_center=b,y.cable_no=s.cable_no,y.doc_id=s.doc_id,y.psr=h;y.sub_station=s.sub_station,y.sketch_no=s.sketch_no,y.circuit=s.circuit,y.emer_title=s.emer_title,y.emer_phone=s.emer_phone,y.sect_point=s.sect_point,y.dc=n,y.pl=a,y.na=r,y.psw=s.psw,y.prot_equip1=C,y.prot_equip2=m,y.throw_type=_,y.srv_type=w,y.circuit_doc_id=s.circuit_doc_id,y.on_site_emerg=c,y.on_site_part=d,y.on_site_nosg=u,y.full_generation=g,y.generation=s.generation+"kW",y.indus_cust="",y.pso_site="",y.demo_site="";y.comments=V;if(this.oEditFlag=="X"){this.getOwnerComponent().getModel("ISUService").update("/Customer_attributeSet('"+y.conn_obj+"')",y,{method:"PUT",success:function(e,t){if(t.statusCode==="204"){var i=JSON.parse(t.headers["sap-message"]);var s=new sap.m.Dialog({title:"Success",type:"Message",state:"Success",content:new sap.m.Text({text:i.message}),endButton:new sap.m.Button({text:"OK",press:function(){s.close()}}),afterClose:function(){s.destroy()}});s.open()}else{sap.m.MessageBox.show(t.statusText,{icon:sap.m.MessageBox.Icon.ERROR,title:this.getView().getModel("i18n").getProperty("error"),actions:[sap.m.MessageBox.Action.OK]})}},error:function(e){var t=JSON.parse(e.responseText);var i=t.error.message.value;sap.m.MessageBox.show(i,{icon:sap.m.MessageBox.Icon.ERROR,title:"Error",actions:[sap.m.MessageBox.Action.OK]})}})}else{this.getOwnerComponent().getModel("ISUService").create("/Customer_attributeSet",y,{success:function(e,t){var i=JSON.parse(t.headers["sap-message"]);if(t.statusCode==="201"){var s=new sap.m.Dialog({title:"Success",type:"Message",state:"Success",content:new sap.m.Text({text:i.message}),endButton:new sap.m.Button({text:"OK",press:function(){s.close();window.history.go(-1)}}),afterClose:function(){s.destroy()}});s.open()}else{sap.m.MessageBox.show(i.message,{icon:sap.m.MessageBox.Icon.ERROR,title:this.getView().getModel("i18n").getProperty("error"),actions:[sap.m.MessageBox.Action.OK]})}},error:function(e){var t=JSON.parse(e.responseText);var i=t.error.message.value;sap.m.MessageBox.show(i,{icon:sap.m.MessageBox.Icon.ERROR,title:"Error",actions:[sap.m.MessageBox.Action.OK]})}})}},onBack:function(e){window.history.go(-1)},onCreateSpecials:function(e){var t=sap.ui.core.UIComponent.getRouterFor(this);t.navTo("CustomerSpecials",{scope:"cd_create"})},onDiplaySpecials:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);e.navTo("CustomerSpecials",{scope:"cd_display"})},fetchSpecialsRecord:async function(e){var t=this.getOwnerComponent().getModel();var i=this.getOwnerComponent().getModel("oSpecialsjmodel");var s=t.bindContext("/getSpecialsRecord(...)");s.setParameter("connection_object",e);var o=this;await s.execute().then(function(e){var t=s.getBoundContext().getObject();console.log(t);if(t&&t.value){console.log(t.value);i.setData(t.value);o.onSpecialsExist(true)}else{console.log("No Specials exist for this child connection object");i.setData({connection_object:o.getOwnerComponent().getModel("oCustomerAttributesJModel").getData().conn_obj,work_desc:"",meter_number:""});o.onSpecialsExist(false)}console.log("success: = ")}.bind(this),function(e){console.log("failure: = "+e.message)}.bind(this))},onCreateServiceTicket:function(){if(!this.oSTDialog){this.oSTDialog=this.loadFragment({name:"com.pso.customerattribute.fragment.CreateServiceTicket"})}this.oSTDialog.then(function(e){this.oDialog=e;this.oDialog.open();this.getView().addDependent(this.oDialog)}.bind(this))},onCloseDialog:function(){this.oDialog.close()},createServiceTicket:function(){var e=[];var t=this.getView().getModel("oCustomerAttributesJModel").getData();var i=this.getView().byId("idDCPLIND_ST").getSelectedIndex();var s="",o="",n="";if(i===0){s="X"}else if(i===1){o="X"}else{n="X"}var a={};a.conn_obj=oCustomerAttributes1.conn_obj,a.cust_name=oCustomerAttributes1.cust_name,a.street_no=oCustomerAttributes1.street_no,a.street_name=oCustomerAttributes1.street_name,a.city=oCustomerAttributes1.city,a.zip_code=oCustomerAttributes1.zip_code,a.no_of_lines=r,a.srv_center=oServiceCentre;var r=this.getView().byId("idNoOfline_ST").getSelectedKey();var l=this.getView().byId("idCustName_ST").getSelectedKey();var c=this.getView().byId("idCity_ST").getSelectedKey();var d=this.getView().byId("idZipCode_ST").getSelectedKey();var g=this.getView().byId("idSrvCenter_ST").getSelectedKey();var u=this.getView().byId("idSubstation_ST").getSelectedKey();var p=this.getView().byId("idCircuit_ST").getSelectedKey();var b=this.getView().byId("idStreetAdd_ST").getValue();var h=this.getView().byId("idPrimarySrvRep_ST").getValue()}})});
//# sourceMappingURL=CustomerDetails.controller.js.map